let can = document.getElementById("canvas");
let detail = document.getElementById("detail");
let ctx = can.getContext("2d");
let w = 40,h = 40;
let nowState;
let current;
let people;
let currentState = 0;  

class coordinate{
  constructor(x,y){
    this.x = x;
    this.y = y;
  }
}
//关卡度
let levels=[];
levels[0]=[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
[0,0,0,0,1,0,0,0,0,0,1,1,1,0,0,0],
[0,0,0,1,1,3,1,1,1,0,0,0,1,0,0,0],
[0,0,0,1,0,4,0,3,0,0,3,0,1,0,0,0],
[0,0,0,1,0,2,2,1,0,3,0,1,1,0,0,0],
[0,0,0,1,1,2,2,1,0,0,0,1,0,0,0,0],
[0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];
levels[1]=[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0],
[0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0],
[0,1,0,0,0,2,1,1,1,0,1,0,0,0,0,0],
[0,1,0,1,0,1,0,0,0,0,1,1,0,0,0,0],
[0,1,0,1,0,3,0,3,1,2,0,1,0,0,0,0],
[0,1,0,1,0,0,5,0,0,1,0,1,0,0,0,0],
[0,1,0,2,1,3,0,3,0,1,0,1,0,0,0,0],
[0,1,1,0,0,0,0,1,0,1,0,1,1,1,0,0],
[0,0,1,0,1,1,1,2,0,0,0,0,4,1,0,0],
[0,0,1,0,0,0,0,0,1,1,0,0,0,1,0,0],
[0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];
levels[2]=[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0],
[0,0,0,0,0,1,1,0,0,1,0,4,1,0,0,0],
[0,0,0,0,0,1,0,0,0,1,0,0,1,0,0,0],
[0,0,0,0,0,1,3,0,3,0,3,0,1,0,0,0],
[0,0,0,0,0,1,0,3,1,1,0,0,1,0,0,0],
[0,0,0,1,1,1,0,3,0,1,0,1,1,0,0,0],
[0,0,0,1,2,2,2,2,2,0,0,1,0,0,0,0],
[0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];
levels[3]=[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0],
[0,0,0,1,0,0,1,1,0,0,0,1,0,0,0,0],
[0,0,0,1,0,0,0,3,0,0,0,1,0,0,0,0],
[0,0,0,1,3,0,1,1,1,0,3,1,0,0,0,0],
[0,0,0,1,0,1,2,2,2,1,0,1,0,0,0,0],
[0,0,1,1,0,1,2,2,2,1,0,1,1,0,0,0],
[0,0,1,0,3,0,0,3,0,0,3,0,1,0,0,0],
[0,0,1,0,0,0,0,0,1,0,4,0,1,0,0,0],
[0,0,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];
levels[4]=[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0],
[0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0],
[0,0,0,0,1,1,1,3,3,3,0,1,0,0,0,0],
[0,0,0,0,1,4,0,3,2,2,0,1,0,0,0,0],
[0,0,0,0,1,0,3,2,2,2,1,1,0,0,0,0],
[0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0],
[0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];
levels[5]=[
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0],
[0,0,0,0,1,1,0,0,0,0,1,0,0,0,0,0],
[0,0,0,0,1,0,3,0,3,3,0,1,0,0,0,0],
[0,0,0,0,1,2,2,2,2,2,2,1,0,0,0,0],
[0,0,0,0,1,0,3,3,0,3,0,1,0,0,0,0],
[0,0,0,0,1,1,1,0,4,1,1,1,0,0,0,0],
[0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];

let resources = {
  "board"   : "images/block.png",
  "tree"    : "images/tree.png",
  "box"     : "images/box.png",
  "destiny" : "images/destiny.png",
  "u"       : "images/u.png",
  "d"       : "images/d.png",
  "l"       : "images/l.png",
  "r"       : "images/r.png",
}

function loadImages(resources,func){
  let images = {};let numberSuccess = 0;
  for(let res in resources){
    images[res] = new Image();  //加载图片
    images[res].onload = function(){
      numberSuccess++;
      if(numberSuccess >= Object.getOwnPropertyNames(resources).length){
        func(images);
      }
    }
    images[res].src= resources[res]; 
  }
  if(numberSuccess >= Object.getOwnPropertyNames(resources).length){
    func(images);
  }
}

let board,tree,box,destiny,u,d,l,r;
loadImages(resources,function(images){  //没写完
  board = images.board;
  tree = images.tree;
  box = images.box;
  destiny = images.destiny;
  u = images.u;
  d = images.d;
  l = images.l;
  r = images.r;
  init();
});

function init(){
  nowState = copyArray(levels[currentState]);
  current = levels[currentState];
  people = d;
  mapInit();
  draw(nowState);
  showCurrentstate();
}


function mapInit(){
  for (let i = 0; i < 16;i++){
    for(let j = 0; j < 16;j++){
      ctx.drawImage(board,w*j,h*i,w,h);
    }
  }
}


var perPosition = new coordinate(1,1)//小人初始坐标
function draw(level){
  for(let i = 0;i < level.length ;i++){
    for(let j = 0;j<level[i].length ;j++){
      let pic = board;
      switch(level[i][j]){
        case 1:
          pic = tree;
          break;
        case 2:
          pic = destiny;
          break;
        case 3:
          pic = box;
          break;
        case 4:
          pic = people;
          perPosition.x = i;
          perPosition.y = j;
          break;
        case 5:
          pic = box;
          break;
      }
    
      ctx.drawImage(pic,w*j-(pic.width-w)/2,h*i-(pic.height-h),pic.width,pic.height)
    }
  }
}  

